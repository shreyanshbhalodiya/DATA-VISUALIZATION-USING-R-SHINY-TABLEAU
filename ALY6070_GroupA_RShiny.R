##ALY6070 - GROUP ASSIGNMENT - GROUP A - R SHINY DASHBOARD
################################################################################
# install.packages('shiny')
# install.packages('ggplot2')
# install.packages('dplyr')
# install.packages('ggthemes')
# install.packages('viridis')
# install.packages('mapcan')
# install.packages('reshape')
# install.packages('plotly')
# install.packages('tidyverse')
# install.packages('ggmosaic')
# install.packages('RColorBrewer')

#PART [1] : LOAD LIBRARY
library(shiny)
library(ggplot2)
library(plotly)
library(dplyr)
library(tidyverse)
library(ggmosaic)
library(RColorBrewer)
library(ggthemes)
library(viridis)
library(mapcan)
library(reshape)

################################################################################
#PART [2] : DATASET
# Load matrices frames of data.
# Each matrix must show your data variables, numbers, provinces, etc. 
mydata1<-matrix(data = c("Year", "B.C", "Alta.", 
                         1975, 1383.35878714174, 992.343323713156, 
                         1976, 1628.32034817086, 1158.89891309998, 
                         1977, 1831.82003271085, 1272.11732262727, 
                         1978, 2044.41389183194, 1465.3552104598, 
                         1979, 2288.57310704556, 1780.9591740735, 
                         1980, 2879.99506756979, 2153.10892233636, 
                         1981, 3430.3725048125, 2623.70427221621, 
                         1982, 3870.24886092447, 3351.65035261713, 
                         1983, 4155.72084859497, 3622.08961832032, 
                         1984, 4428.91633711193, 3764.22917885827, 
                         1985, 4637.90865069251, 4070.41301869285, 
                         1986, 4984.08596641948, 4448.47801711877, 
                         1987, 5341.28663991549, 4499.89163039372, 
                         1988, 5839.14894972573, 4830.58512686067, 
                         1989, 6509.73671029317, 5349.76562366944, 
                         1990, 7376.31723635814, 5749.41380476617, 
                         1991, 8127.35199859456, 6062.54095612859, 
                         1992, 8769.72890509511, 6430.65312378625, 
                         1993, 9297.44510196595, 6520.433399575, 
                         1994, 9771.32410154034, 6313.44303512831, 
                         1995, 10113.2356534136, 6092.48026310455, 
                         1996, 10378.1194617981, 6320.62953659314, 
                         1997, 10831.9845279822, 7082.14888000143, 
                         1998, 11414.3381435849, 7619.82432139012, 
                         1999, 12279.7003602781, 8701.73463919487, 
                         2000, 13412.6030392207, 9601.75163018843, 
                         2001, 14680.0627816059, 10962.4220540117, 
                         2002, 15670.1522119533, 11793.7884263925, 
                         2003, 16396.3014240724, 12628.006229712, 
                         2004, 17124.0722698081, 13848.3970530796, 
                         2005, 18022.3516348998, 15321.1984635138, 
                         2006, 19403.268232363, 17255.0091538278, 
                         2007, 20590.0015666545, 19145.3397637144, 
                         2008, 22170.951318772, 20439.0682380995, 
                         2009, 22965.235123637, 21566.4061814085, 
                         2010, 24310.2882364733, 23727.5397283606, 
                         2011, 25047.3973706268, 24614.0507885794, 
                         2012, 26037.2418803282, 25802.2819620776, 
                         2013, 25909.1576610064, 26816.1074490244, 
                         2014, 27341.1165243974, 28487.045628523, 
                         2015, 28356.4187708856, 29999.969916187, 
                         2016, 29565.3907130796, 31279.2850586753, 
                         2017, 30677.2851115974, 32266.6151656363, 
                         2018, 31869.4747036428, 33407.4543463819, 
                         2019, 33382.8833433967, 34337.0184929), nrow = 46, ncol = 3, byrow = TRUE)
colnames(mydata1) <- mydata1[1, ]
mydata1 <- mydata1[-1, ]
mydata1 <- as.data.frame(mydata1)
# Convert Year and Expenditure to numeric
mydata1$Year <- as.numeric(as.character(mydata1$Year))
mydata1$B.C <- as.numeric(as.character(mydata1$B.C))
mydata1$Alta. <- as.numeric(as.character(mydata1$Alta.))

mydata2 <- data.frame(Year = c(1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,
                                1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,
                                2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,
                                2014,2015,2016,2017,2018,2019),
                      Alb_prvt = c(234.5710792,260.4369903,293.2544876,337.6971011,
                                    389.0818591,493.0536925,581.5095746,786.9134548,
                                    720.4870992,767.4577698,831.2846424,910.5911206,
                                    985.5208436,1184.941543,1318.75034,1422.520773,
                                    1505.059399,1584.236188,1719.905168,1785.661427,
                                    1809.002815,1854.160534,2140.103765,2265.857873,
                                    2561.556757,2808.829985,3218.447161,3337.375278,
                                    3522.464474,3882.299182,4256.848496,5073.643735,
                                    5432.928342,5651.854359,5852.829318,6247.532953,
                                    6527.689039,6836.879717,7080.974533,8051.696085,
                                    8776.156537,9257.752015,9361.565764,9675.779142,
                                    10138.95239),
                      BC_prvt = c(388.8425371,471.1523482,556.8345327,599.9028918,643.351357,
                                   807.9490676,879.0855048,943.1221109,1026.937349,1159.209555,
                                   1227.140627,1317.231057,1444.928198,1597.12081,1772.980444,
                                   1985.950982,2159.538498,2291.184241,2427.012819,2533.205148,
                                   2574.307159,2689.388301,2889.353011,3109.842097,3310.25963,
                                   3586.753682,3860.321259,4218.029482,4466.497009,4893.719085,
                                   5021.96326,5858.297685,6006.729709,6566.254959,6637.550681,
                                   7208.422951,7341.18151,7663.671959,7302.611346,8108.24367,
                                   8427.704559,8762.162923,9151.741018,9456.813045,9960.246574),
                      Alb_public = c(757.7722445,898.4619228,978.862835,1127.658109,1391.877315,1660.05523,
                                      2042.194698,2564.736898,2901.602519,2996.771409,3239.128376,3537.886897,
                                      3514.370787,3645.643583,4031.015284,4326.893032,4557.481557,4846.416936,
                                      4800.528232,4527.781608,4283.477448,4466.469003,4942.045115,5353.966448,
                                      6140.177882,6792.921645,7743.974893,8456.413149,9105.541756,9966.097871,
                                      11064.34997,12181.36542,13712.41142,14787.21388,15713.57686,17480.00678,
                                      18086.36175,18965.40224,19735.13292,20435.34954,21223.81338,22021.53304,
                                      22905.0494,23731.6752,24198.0661),
                      BC_public = c(994.520,1157.17,1274.99,1444.51,1645.22,2072.05,2551.29,2927.13,3128.78,3269.71,3410.77,
                                     3666.85,3896.36,4242.03,4736.76,5390.37,5967.81,6478.54,6870.43,7238.12,7538.93,7688.73,
                                     7942.63,8304.50,8969.44,9825.850,10819.74,11452.12,11929.80,12230.35,13000.39,13544.97,14583.27,
                                     15604.70,16327.68,17101.87,17706.22,18373.57,18606.55,19232.87,19928.71,20803.23,21525.54,22412.66,
                                     23422.64))

mydata3 <- mydata2

mydata4 <- matrix(data = c("Alta.", "B.C.",     
                           9.5,	9.0,
                           21.9,	11.4,
                           33.7,	12.3,
                           38.5,	11.6,
                           55.8,	13.4,
                           66.6,	40.9,
                           76.5,	56.6,
                           42.4,	61.9,
                           26.3,	37.8,
                           23.5,	24.1,
                           66.4,	25.6,
                           70.2,	24.7,
                           53.3,	24.5,
                           55.8,	21.8,
                           58.5,	17.7,
                           62.7,	27.9,
                           58.4,	45.8,
                           66.2,	47.7,
                           66.6,	52.9,
                           123.4,	53.5,
                           50.8, 55.4,
                           50.2,	36.4,
                           55.6,	17.6,
                           64.0,	13.7,
                           60.1,	13.9,
                           69.7,	17.5,
                           83.5,	17.6,
                           91.1,	23.1,
                           102.5,	21.0,
                           102.9,19.7,
                           78.5,	25.0,
                           76.5,	27.6,
                           107.3,	31.5,
                           112.4, 32.1,
                           114.5,	34.9,
                           117.0,	39.3,
                           126.8,	43.0,
                           140.2,	47.1,
                           147.9,	51.0,
                           156.3,	56.0,
                           120.7,	75.6,
                           120.7,	64.3,
                           124.3,	44.2,
                           131.4,	42.8,
                           135.9,	43.0), nrow = 46, ncol = 2, byrow = TRUE)
colnames(mydata4) <- mydata4[1, ]
mydata4 <- mydata4[-1, ]
mydata4 <- as.data.frame(mydata4)
mydata4$Alta. <- as.numeric(as.character(mydata4$Alta.))
mydata4$B.C. <- as.numeric(as.character(mydata4$B.C.))


mydata5 <- data.frame(
  Year <- seq(1975, 2019,1),
  TotalHealthExpAlta = c(992.3433237, 1158.898913, 1272.117323, 1465.35521, 1780.959174, 2153.108922, 2623.704272, 3351.650353, 3622.089618, 3764.229179, 4070.413019, 4448.478017, 4499.89163, 4830.585127, 5349.765624, 5749.413805, 6062.540956, 6430.653124, 6520.4334, 6313.443035, 6092.480263, 6320.629537, 7082.14888, 7619.824321, 8701.734639, 9601.75163, 10962.42205, 11793.78843, 12628.00623, 13848.39705, 15321.19846, 17255.00915, 19145.33976, 20439.06824, 21566.40618, 23727.53973, 24614.05079, 25802.28196, 26816.10745, 28487.04563, 29999.96992, 31279.28506, 32266.61517, 33407.45435, 34337.01849),
  TotalHealthExp_BC = c(1383.358787, 1628.320348, 1831.820033, 2044.413892, 2288.573107, 2879.995068, 3430.372505, 3870.248861, 4155.720849, 4428.916337, 4637.908651, 4984.085966, 5341.28664, 5839.14895, 6509.73671, 7376.317236, 8127.351999, 8769.728905, 9297.445102, 9771.324102, 10113.23565, 10378.11946, 10831.98453, 11414.33814, 12279.70036, 13412.60304, 14680.06278, 15670.15221, 16396.30142, 17124.07227, 18022.35163, 19403.26823, 20590.00157, 22170.95132, 22965.23512, 24310.28824, 25047.39737, 26037.24188, 25909.15766, 27341.11652, 28356.41877, 29565.39071, 30677.28511, 31869.4747, 33382.88334),
  PrivExp_Alta = c(234.5710792, 260.4369903, 293.2544876, 337.6971011, 389.0818591, 493.0536925, 581.5095746, 786.9134548, 720.4870992, 767.4577698, 831.2846424, 910.5911206, 985.5208436, 1184.941543, 1318.75034, 1422.520773, 1505.059399, 1584.236188, 1719.905168, 1785.661427, 1809.002815, 1854.160534, 2140.103765, 2265.857873, 2561.556757, 2808.829985, 3218.447161, 3337.375278, 3522.464474, 3882.299182, 4256.848496, 5073.643735, 5432.928342, 5651.854359, 5852.829318, 6247.532953, 6527.689039, 6836.879717, 7080.974533, 8051.696085, 8776.156537, 9257.752015, 9361.565764, 9675.779142, 10138.95239),
  PrivExp_BC = c( 388.8425371, 471.1523482, 556.8345327, 599.9028918, 643.351357, 807.9490676, 879.0855048, 943.1221109, 1026.937349, 1159.209555, 1227.140627, 1317.231057, 1444.928198, 1597.12081, 1772.980444, 1985.950982, 2159.538498, 2291.184241, 2427.012819, 2533.205148, 2574.307159, 2689.388301, 2889.353011, 3109.842097, 3310.25963, 3586.753682, 3860.321259, 4218.029482, 4466.497009, 4893.719085, 5021.96326, 5858.297685, 6006.729709, 6566.254959, 6637.550681, 7208.422951, 7341.18151, 7663.671959, 7302.611346, 8108.24367, 8427.704559, 8762.162923, 9151.741018, 9456.813045, 9960.246574),
  PubExp_Alta = c(757.7722445, 898.4619228, 978.862835, 1127.658109, 1391.877315, 1660.05523, 2042.194698, 2564.736898, 2901.602519, 2996.771409, 3239.128376, 3537.886897, 3514.370787, 3645.643583, 4031.015284, 4326.893032, 4557.481557, 4846.416936, 4800.528232, 4527.781608, 4283.477448, 4466.469003, 4942.045115, 5353.966448, 6140.177882, 6792.921645, 7743.974893, 8456.413149, 9105.541756, 9966.097871, 11064.34997, 12181.36542, 13712.41142, 14787.21388, 15713.57686, 17480.00678, 18086.36175, 18965.40224, 19735.13292, 20435.34954, 21223.81338, 22021.53304, 22905.0494, 23731.6752, 24198.0661),
  PubExp_BC = c(994.51625, 1157.168, 1274.9855, 1444.511, 1645.22175, 2072.046, 2551.287, 2927.12675, 3128.7835, 3269.706782, 3410.768024, 3666.85491, 3896.358442, 4242.02814, 4736.756267, 5390.366254, 5967.813501, 6478.544664, 6870.432283, 7238.118953, 7538.928494, 7688.73116, 7942.631517, 8304.496047, 8969.440731, 9825.849358, 10819.74152, 11452.12273, 11929.80441, 12230.35318, 13000.38838, 13544.97055, 14583.27186, 15604.69636, 16327.68444, 17101.86529, 17706.21586, 18373.56992, 18606.54632, 19232.87285, 19928.71421, 20803.22779, 21525.54409, 22412.66166, 23422.63677),
  ProvGov_Alta = c(694.9125, 811.55025, 879.069, 1020.45225, 1258.1865, 1510.1645, 1871.283, 2426.27325, 2769.36125, 2843.46325, 3035.054, 3316.84475, 3308.086371, 3427.776949, 3792.921136, 4043.777534, 4240.961984, 4506.25231, 4452.228757, 4103.517569, 3904.78869, 4091.294814, 4527.6237, 4895.970799, 5641.097562, 6214.880896, 7033.82665, 7730.892631, 8286.957621, 9110.345135, 10197.51527, 11258.68489, 12704.10433, 13739.60348, 14586.62247, 16367.23127, 16918.2738, 17726.72806, 18460.56505, 19137.80314, 19943.09164, 20710.08188, 21506.13705, 22207.64995, 22573.76162),
  ProvGov_BC = c(928.1825, 1082.7025, 1193.111, 1363.82575, 1556.4595, 1932.33, 2374.79825, 2720.31675, 2932.23, 3074.847, 3200.6145, 3443.256, 3660.79225, 3978.277689, 4455.928853, 5043.609472, 5578.253207, 6060.745229, 6424.131848, 6740.864015, 7007.061861, 7186.071458, 7434.943701, 7758.357549, 8390.76899, 9164.781693, 10118.42768, 10763.57871, 11185.53538, 11434.46445, 12168.89201, 12690.00375, 13640.22377, 14531.16538, 15166.4771, 15915.53031, 16494.11927, 17051.98585, 17239.24865, 17829.28714, 18493.98517, 19278.44363, 19932.04354, 20771.52858, 21670.3227),
  OthPub_Alta = c(62.85974448, 86.9116728, 99.79383499, 107.2058594, 133.690815, 149.8907298, 170.9116976, 138.4636478, 132.2412691, 153.308159, 204.0743763, 221.0421465, 206.284416, 217.8666347, 238.0941483, 283.1154981, 316.5195728, 340.1646263, 348.2994747, 424.2640385, 378.6887583, 375.1741884, 414.4214144, 457.995649, 499.0803203, 578.0407485, 710.1482433, 725.5205178, 818.5841345, 855.7527365, 866.8346954, 922.6805245, 1008.307091, 1047.610397, 1126.954391, 1112.775504, 1168.087948, 1238.674181, 1274.56787, 1297.546402, 1280.721743, 1311.451165, 1398.912353, 1524.025255, 1624.304484),
  OthPub_BC = c(66.33375, 74.4655, 81.8745, 80.68525, 88.76225, 139.716, 176.48875, 206.81, 196.5535, 194.8597825, 210.1535242, 223.5989098, 235.5661923, 263.7504504, 280.8274133, 346.7567826, 389.5602931, 417.7994351, 446.3004345, 497.2549389, 531.8666328, 502.6597021, 507.6878164, 546.1384977, 578.6717408, 661.0676644, 701.3138453, 688.5440233, 744.2690354, 795.8887339, 831.4963649, 854.9667971, 943.0480837, 1073.53098, 1161.207346, 1186.334975, 1212.096589, 1321.584068, 1367.297668, 1403.585714, 1434.729047, 1524.784157, 1593.500557, 1641.133078, 1752.314071),
  FedDirHealth_Alta = c(43.6085, 51.97225, 51.7245, 53.22675, 59.664, 59.81075, 65.53725, 77.522, 93.20825, 100.4875, 102.3305, 113.4947504, 116.9599998, 123.7649314, 137.2999448, 166.4574104, 183.492328, 191.9127073, 202.9566678, 231.1382502, 253.1545623, 248.1344154, 276.2600064, 298.63138, 334.0096623, 380.5099025, 480.5798283, 472.4483358, 528.6056265, 542.3658905, 565.7223874, 602.0605165, 652.0735715, 665.0529357, 732.542569, 707.8274251, 725.5599954, 772.7419966, 782.3334008, 785.4961867, 796.331838, 832.1116362, 902.6187467, 965.6503179, 1040.760834),
  FedDirHealth_BC = c(39.66675, 42.7105, 47.0125, 43.63525, 46.32825, 59.619, 72.94175, 89.392, 99.9365, 114.30825, 129.29825, 141.0645073, 148.5007512, 171.4336748, 192.7561042, 233.1098598, 255.0412855, 273.3391621, 289.2947255, 324.0760979, 347.447734, 345.5789391, 366.5775167, 395.5631915, 399.8464902, 463.2592533, 529.4576311, 516.2359336, 573.9900651, 609.5413433, 629.7009752, 656.8902698, 729.4259401, 805.2957144, 913.0910787, 896.174763, 913.4050141, 989.8065428, 1016.843751, 1060.949382, 1068.755772, 1171.705357, 1244.423765, 1289.55024, 1381.400957),
  MunipGovt_Alta = c(9.515244481, 21.9214228, 33.68233499, 38.53110937, 55.751815, 66.56897983, 76.50544763, 42.3646478, 26.3020191, 23.50165905, 66.35987634, 70.23042116, 53.30115021, 55.75120936, 58.46906146, 62.73215471, 58.43787782, 66.23991645, 66.62500793, 123.3633514, 50.807, 50.243, 55.584, 64.043, 60.051, 69.676, 83.515, 91.095, 102.53, 102.861, 78.485, 76.508, 107.325, 112.438, 114.5316567, 117.0201103, 126.7521314, 140.2183833, 147.9196148, 156.2601721, 120.7464966, 120.7464966, 124.2978641, 131.4005992, 135.9055788),
  MunipGovt_BC = c(9.024, 11.431, 12.323, 11.627, 13.365, 40.865, 56.64, 61.872, 37.782, 24.05253249, 25.61427417, 24.67240254, 24.5362393, 21.75885737, 17.73475436, 27.87661014, 45.77902683, 47.658, 52.863, 53.459, 55.395, 36.39365, 17.59, 13.737, 13.944, 17.46, 17.635, 23.107, 20.968, 19.706, 24.953, 27.55, 31.493, 32.067, 34.92224189, 39.27709158, 43.01248336, 47.0624954, 51.00073929, 55.96207983, 75.63624852, 64.26895105, 44.15757862, 42.84596737, 42.95828773),
  SocialSec_Alta = c(9.736, 13.018, 14.387, 15.448, 18.275, 23.511, 28.869, 18.577, 12.731, 29.319, 35.384, 37.316975, 36.023266, 38.350494, 42.325142, 53.925933, 74.589367, 82.01200257, 78.71779898, 69.762437, 74.727196, 76.796773, 82.577408, 95.321269, 105.019658, 127.854846, 146.053415, 161.977182, 187.448508, 210.525846, 222.627308, 244.112008, 248.90852, 270.119461, 279.880165, 287.927969, 315.775821, 325.713801, 344.314854, 355.790043, 363.643408, 358.593032, 371.995742, 426.974338, 447.638072),
  SocialSec_BC = c(17.643, 20.324, 22.539, 25.423, 29.069, 39.232, 46.907, 55.546, 58.835, 56.499, 55.241, 57.862, 62.52920177, 70.55791819, 70.3365547, 85.77031267, 88.73998073, 96.802273, 104.142709, 119.719841, 129.0238987, 120.687113, 123.5202997, 136.8383062, 164.8812505, 180.3484111, 154.2212142, 149.2010897, 149.3109703, 166.6413906, 176.8423897, 170.5265274, 182.1291436, 236.1682653, 213.1940257, 250.8831204, 255.6790919, 284.7150298, 299.4531776, 286.6742519, 290.3370262, 288.8098488, 304.9192136, 308.7368706, 327.9548262)
)


mydata6 <- data.frame(
  Year <- seq(1975, 2019,1),
  TotalHealthExpAlta = c(992.3433237, 1158.898913, 1272.117323, 1465.35521, 1780.959174, 2153.108922, 2623.704272, 3351.650353, 3622.089618, 3764.229179, 4070.413019, 4448.478017, 4499.89163, 4830.585127, 5349.765624, 5749.413805, 6062.540956, 6430.653124, 6520.4334, 6313.443035, 6092.480263, 6320.629537, 7082.14888, 7619.824321, 8701.734639, 9601.75163, 10962.42205, 11793.78843, 12628.00623, 13848.39705, 15321.19846, 17255.00915, 19145.33976, 20439.06824, 21566.40618, 23727.53973, 24614.05079, 25802.28196, 26816.10745, 28487.04563, 29999.96992, 31279.28506, 32266.61517, 33407.45435, 34337.01849),
  TotalHealthExp_BC = c(1383.358787, 1628.320348, 1831.820033, 2044.413892, 2288.573107, 2879.995068, 3430.372505, 3870.248861, 4155.720849, 4428.916337, 4637.908651, 4984.085966, 5341.28664, 5839.14895, 6509.73671, 7376.317236, 8127.351999, 8769.728905, 9297.445102, 9771.324102, 10113.23565, 10378.11946, 10831.98453, 11414.33814, 12279.70036, 13412.60304, 14680.06278, 15670.15221, 16396.30142, 17124.07227, 18022.35163, 19403.26823, 20590.00157, 22170.95132, 22965.23512, 24310.28824, 25047.39737, 26037.24188, 25909.15766, 27341.11652, 28356.41877, 29565.39071, 30677.28511, 31869.4747, 33382.88334),
  PrivExp_Alta = c(234.5710792, 260.4369903, 293.2544876, 337.6971011, 389.0818591, 493.0536925, 581.5095746, 786.9134548, 720.4870992, 767.4577698, 831.2846424, 910.5911206, 985.5208436, 1184.941543, 1318.75034, 1422.520773, 1505.059399, 1584.236188, 1719.905168, 1785.661427, 1809.002815, 1854.160534, 2140.103765, 2265.857873, 2561.556757, 2808.829985, 3218.447161, 3337.375278, 3522.464474, 3882.299182, 4256.848496, 5073.643735, 5432.928342, 5651.854359, 5852.829318, 6247.532953, 6527.689039, 6836.879717, 7080.974533, 8051.696085, 8776.156537, 9257.752015, 9361.565764, 9675.779142, 10138.95239),
  PrivExp_BC = c( 388.8425371, 471.1523482, 556.8345327, 599.9028918, 643.351357, 807.9490676, 879.0855048, 943.1221109, 1026.937349, 1159.209555, 1227.140627, 1317.231057, 1444.928198, 1597.12081, 1772.980444, 1985.950982, 2159.538498, 2291.184241, 2427.012819, 2533.205148, 2574.307159, 2689.388301, 2889.353011, 3109.842097, 3310.25963, 3586.753682, 3860.321259, 4218.029482, 4466.497009, 4893.719085, 5021.96326, 5858.297685, 6006.729709, 6566.254959, 6637.550681, 7208.422951, 7341.18151, 7663.671959, 7302.611346, 8108.24367, 8427.704559, 8762.162923, 9151.741018, 9456.813045, 9960.246574),
  PubExp_Alta = c(757.7722445, 898.4619228, 978.862835, 1127.658109, 1391.877315, 1660.05523, 2042.194698, 2564.736898, 2901.602519, 2996.771409, 3239.128376, 3537.886897, 3514.370787, 3645.643583, 4031.015284, 4326.893032, 4557.481557, 4846.416936, 4800.528232, 4527.781608, 4283.477448, 4466.469003, 4942.045115, 5353.966448, 6140.177882, 6792.921645, 7743.974893, 8456.413149, 9105.541756, 9966.097871, 11064.34997, 12181.36542, 13712.41142, 14787.21388, 15713.57686, 17480.00678, 18086.36175, 18965.40224, 19735.13292, 20435.34954, 21223.81338, 22021.53304, 22905.0494, 23731.6752, 24198.0661),
  PubExp_BC = c(994.51625, 1157.168, 1274.9855, 1444.511, 1645.22175, 2072.046, 2551.287, 2927.12675, 3128.7835, 3269.706782, 3410.768024, 3666.85491, 3896.358442, 4242.02814, 4736.756267, 5390.366254, 5967.813501, 6478.544664, 6870.432283, 7238.118953, 7538.928494, 7688.73116, 7942.631517, 8304.496047, 8969.440731, 9825.849358, 10819.74152, 11452.12273, 11929.80441, 12230.35318, 13000.38838, 13544.97055, 14583.27186, 15604.69636, 16327.68444, 17101.86529, 17706.21586, 18373.56992, 18606.54632, 19232.87285, 19928.71421, 20803.22779, 21525.54409, 22412.66166, 23422.63677),
  ProvGov_Alta = c(694.9125, 811.55025, 879.069, 1020.45225, 1258.1865, 1510.1645, 1871.283, 2426.27325, 2769.36125, 2843.46325, 3035.054, 3316.84475, 3308.086371, 3427.776949, 3792.921136, 4043.777534, 4240.961984, 4506.25231, 4452.228757, 4103.517569, 3904.78869, 4091.294814, 4527.6237, 4895.970799, 5641.097562, 6214.880896, 7033.82665, 7730.892631, 8286.957621, 9110.345135, 10197.51527, 11258.68489, 12704.10433, 13739.60348, 14586.62247, 16367.23127, 16918.2738, 17726.72806, 18460.56505, 19137.80314, 19943.09164, 20710.08188, 21506.13705, 22207.64995, 22573.76162),
  ProvGov_BC = c(928.1825, 1082.7025, 1193.111, 1363.82575, 1556.4595, 1932.33, 2374.79825, 2720.31675, 2932.23, 3074.847, 3200.6145, 3443.256, 3660.79225, 3978.277689, 4455.928853, 5043.609472, 5578.253207, 6060.745229, 6424.131848, 6740.864015, 7007.061861, 7186.071458, 7434.943701, 7758.357549, 8390.76899, 9164.781693, 10118.42768, 10763.57871, 11185.53538, 11434.46445, 12168.89201, 12690.00375, 13640.22377, 14531.16538, 15166.4771, 15915.53031, 16494.11927, 17051.98585, 17239.24865, 17829.28714, 18493.98517, 19278.44363, 19932.04354, 20771.52858, 21670.3227),
  OthPub_Alta = c(62.85974448, 86.9116728, 99.79383499, 107.2058594, 133.690815, 149.8907298, 170.9116976, 138.4636478, 132.2412691, 153.308159, 204.0743763, 221.0421465, 206.284416, 217.8666347, 238.0941483, 283.1154981, 316.5195728, 340.1646263, 348.2994747, 424.2640385, 378.6887583, 375.1741884, 414.4214144, 457.995649, 499.0803203, 578.0407485, 710.1482433, 725.5205178, 818.5841345, 855.7527365, 866.8346954, 922.6805245, 1008.307091, 1047.610397, 1126.954391, 1112.775504, 1168.087948, 1238.674181, 1274.56787, 1297.546402, 1280.721743, 1311.451165, 1398.912353, 1524.025255, 1624.304484),
  OthPub_BC = c(66.33375, 74.4655, 81.8745, 80.68525, 88.76225, 139.716, 176.48875, 206.81, 196.5535, 194.8597825, 210.1535242, 223.5989098, 235.5661923, 263.7504504, 280.8274133, 346.7567826, 389.5602931, 417.7994351, 446.3004345, 497.2549389, 531.8666328, 502.6597021, 507.6878164, 546.1384977, 578.6717408, 661.0676644, 701.3138453, 688.5440233, 744.2690354, 795.8887339, 831.4963649, 854.9667971, 943.0480837, 1073.53098, 1161.207346, 1186.334975, 1212.096589, 1321.584068, 1367.297668, 1403.585714, 1434.729047, 1524.784157, 1593.500557, 1641.133078, 1752.314071),
  FedDirHealth_Alta = c(43.6085, 51.97225, 51.7245, 53.22675, 59.664, 59.81075, 65.53725, 77.522, 93.20825, 100.4875, 102.3305, 113.4947504, 116.9599998, 123.7649314, 137.2999448, 166.4574104, 183.492328, 191.9127073, 202.9566678, 231.1382502, 253.1545623, 248.1344154, 276.2600064, 298.63138, 334.0096623, 380.5099025, 480.5798283, 472.4483358, 528.6056265, 542.3658905, 565.7223874, 602.0605165, 652.0735715, 665.0529357, 732.542569, 707.8274251, 725.5599954, 772.7419966, 782.3334008, 785.4961867, 796.331838, 832.1116362, 902.6187467, 965.6503179, 1040.760834),
  FedDirHealth_BC = c(39.66675, 42.7105, 47.0125, 43.63525, 46.32825, 59.619, 72.94175, 89.392, 99.9365, 114.30825, 129.29825, 141.0645073, 148.5007512, 171.4336748, 192.7561042, 233.1098598, 255.0412855, 273.3391621, 289.2947255, 324.0760979, 347.447734, 345.5789391, 366.5775167, 395.5631915, 399.8464902, 463.2592533, 529.4576311, 516.2359336, 573.9900651, 609.5413433, 629.7009752, 656.8902698, 729.4259401, 805.2957144, 913.0910787, 896.174763, 913.4050141, 989.8065428, 1016.843751, 1060.949382, 1068.755772, 1171.705357, 1244.423765, 1289.55024, 1381.400957),
  MunipGovt_Alta = c(9.515244481, 21.9214228, 33.68233499, 38.53110937, 55.751815, 66.56897983, 76.50544763, 42.3646478, 26.3020191, 23.50165905, 66.35987634, 70.23042116, 53.30115021, 55.75120936, 58.46906146, 62.73215471, 58.43787782, 66.23991645, 66.62500793, 123.3633514, 50.807, 50.243, 55.584, 64.043, 60.051, 69.676, 83.515, 91.095, 102.53, 102.861, 78.485, 76.508, 107.325, 112.438, 114.5316567, 117.0201103, 126.7521314, 140.2183833, 147.9196148, 156.2601721, 120.7464966, 120.7464966, 124.2978641, 131.4005992, 135.9055788),
  MunipGovt_BC = c(9.024, 11.431, 12.323, 11.627, 13.365, 40.865, 56.64, 61.872, 37.782, 24.05253249, 25.61427417, 24.67240254, 24.5362393, 21.75885737, 17.73475436, 27.87661014, 45.77902683, 47.658, 52.863, 53.459, 55.395, 36.39365, 17.59, 13.737, 13.944, 17.46, 17.635, 23.107, 20.968, 19.706, 24.953, 27.55, 31.493, 32.067, 34.92224189, 39.27709158, 43.01248336, 47.0624954, 51.00073929, 55.96207983, 75.63624852, 64.26895105, 44.15757862, 42.84596737, 42.95828773),
  SocialSec_Alta = c(9.736, 13.018, 14.387, 15.448, 18.275, 23.511, 28.869, 18.577, 12.731, 29.319, 35.384, 37.316975, 36.023266, 38.350494, 42.325142, 53.925933, 74.589367, 82.01200257, 78.71779898, 69.762437, 74.727196, 76.796773, 82.577408, 95.321269, 105.019658, 127.854846, 146.053415, 161.977182, 187.448508, 210.525846, 222.627308, 244.112008, 248.90852, 270.119461, 279.880165, 287.927969, 315.775821, 325.713801, 344.314854, 355.790043, 363.643408, 358.593032, 371.995742, 426.974338, 447.638072),
  SocialSec_BC = c(17.643, 20.324, 22.539, 25.423, 29.069, 39.232, 46.907, 55.546, 58.835, 56.499, 55.241, 57.862, 62.52920177, 70.55791819, 70.3365547, 85.77031267, 88.73998073, 96.802273, 104.142709, 119.719841, 129.0238987, 120.687113, 123.5202997, 136.8383062, 164.8812505, 180.3484111, 154.2212142, 149.2010897, 149.3109703, 166.6413906, 176.8423897, 170.5265274, 182.1291436, 236.1682653, 213.1940257, 250.8831204, 255.6790919, 284.7150298, 299.4531776, 286.6742519, 290.3370262, 288.8098488, 304.9192136, 308.7368706, 327.9548262)
)

##Plot 7
province <- c("British Columbia", "Alberta")
abbreviated <- c("British Columbia", "Alberta")
expenditure <- c(13701.002, 12346.125)
mydata7 <- data.frame(province, abbreviated, expenditure)

#Plot8
# Part 8
mydata8 <- data.frame(
  Year = c(1975:2019),
  Alta. = c(992.343323713156, 1158.89891309998, 1272.11732262727, 1465.3552104598, 1780.9591740735,
            2153.10892233636, 2623.70427221621, 3351.65035261713, 3622.08961832032, 3764.22917885827,
            4070.41301869285, 4448.47801711877, 4499.89163039372, 4830.58512686067, 5349.76562366944,
            5749.41380476617, 6062.54095612859, 6430.65312378625, 6520.433399575, 6313.44303512831,
            6092.48026310455, 6320.62953659314, 7082.14888000143, 7619.82432139012, 8701.73463919487,
            9601.75163018843, 10962.4220540117, 11793.7884263925, 12628.0062297119, 13848.3970530796,
            15321.1984635138, 17255.0091538278, 19145.3397637144, 20439.0682380995, 21566.4061814085,
            23727.5397283606, 24614.0507885794, 25802.2819620776, 26816.1074490244, 28487.045628523,
            29999.969916187, 31279.2850586753, 32266.6151656363, 33407.4543463819, 34337.0184929),
  B.C. = c(1383.35878714174, 1628.32034817086, 1831.82003271085, 2044.41389183194, 2288.57310704556,
           2879.99506756979, 3430.3725048125, 3870.24886092447, 4155.72084859497, 4428.91633711193,
           4637.90865069251, 4984.08596641948, 5341.28663991549, 5839.14894972573, 6509.73671029317,
           7376.31723635814, 8127.35199859456, 8769.72890509511, 9297.44510196595, 9771.32410154034,
           10113.2356534136, 10378.1194617981, 10831.9845279822, 11414.3381435849, 12279.7003602781,
           13412.6030392207, 14680.0627816059, 15670.1522119533, 16396.3014240724, 17124.0722698081,
           18022.3516348998, 19403.268232363, 20590.0015666545, 22170.951318772, 22965.235123637,
           24310.2882364733, 25047.3973706268, 26037.2418803282, 25909.1576610064, 27341.1165243974,
           28356.4187708856, 29565.3907130796, 30677.2851115974, 31869.4747036428, 33382.8833433967))

################################################################################
#PART [3] : UI PART

# Define UI  Panel of components. 
ui <- fluidPage(
  navbarPage(
    "Analysis of Health Expenditure for West Canadian Provinces (Alberta, British Columbia)",
    tabPanel("Plot 1",
      sidebarLayout(
        sidebarPanel(
          sliderInput(
            inputId = "scatterYear",
            label = "Select Year:",
            min = 1975,
            max = 2020,
            value = 1975,
            step = 2
            
          )
        ),
        mainPanel(
          plotOutput("Plot1")
        )
      )
    ),
    tabPanel("Plot 2",
             sidebarLayout(
               sidebarPanel(
                 selectInput("state1", "SELECT PROVINCE",choices = c("Alberta","BC"), selected = "BC")),
               mainPanel(
                 plotOutput("Plot2")
               )
             )
    ),
    
    tabPanel("Plot 3",
             sidebarLayout(
               sidebarPanel(
                 selectInput("state2", "SELECT PROVINCE",choices = c("Alberta","BC"),selected="BC")),
               mainPanel(
                 plotOutput("Plot3")
               )
             )
    ),
    tabPanel("Plot 4",
    sidebarLayout(
      sidebarPanel(
        selectInput("variable", "Select Province:", choices = c("Alta.", "B.C."), selected = "Alta.")
      ),
      mainPanel(plotOutput("Plot4"))
      )
    ),
    tabPanel("Plot 5",
    sidebarLayout(
      sidebarPanel(
        sliderInput("year1", "Select Year for Boxplot:", min = min(mydata5$Year), max = 2019, value = c(min(mydata5$Year), max(mydata5$Year)), step=1)
      ),
      mainPanel(plotOutput("Plot5", height = "800px", width = "100%"))
      )
    ),
    tabPanel("Plot 6",
    sidebarLayout(
      sidebarPanel(
        sliderInput("year2", "Select Year for Mosaic Plot:", min = min(mydata6$Year), max = max(mydata6$Year), c(min(mydata6$Year), max(mydata6$Year)), step=1)
      ),
      mainPanel(plotOutput("Plot6", height = "800px", width = "100%")))
    ),
    tabPanel(
      "Plot 7",
      sidebarLayout(
        sidebarPanel(
          sliderInput("part7_expenditure_range", "Expenditure Range", min = 12000, max = max(mydata7$expenditure), value = c(12000, max(mydata7$expenditure)), step=100)
        ),
        mainPanel(
          plotOutput("Plot7")
        )
      )
    ),
    tabPanel(
      "Plot 8",
      sidebarLayout(
        sidebarPanel(
          sliderInput("part8_freq_range", "Year Range", min = min(mydata8$Year), max = max(mydata8$Year), value = c(min(mydata8$Year), max(mydata8$Year)), step=1)
        ),
        mainPanel(
          plotOutput("Plot8")
        )      )
    )
    
  )
  )


################################################################################
# PART [4] : SERVER PART

# Define server  with component output
server <- function(input, output) {
  
  
  output$Plot1 <- renderPlot({
    year <- input$scatterYear
    
    filtered_data <- mydata1[mydata1$Year <= year, ]
    
    ggplot() +
      geom_blank(data = mydata1, aes(x = Year)) +
      geom_point(data = filtered_data, aes(x = Year, y = B.C, color = "B.C.")) +
      geom_point(data = filtered_data, aes(x = Year, y = Alta., color = "Alta.")) +
      labs(
        x = "Year",
        y = "Health Expenditure (million dollars)",
        title = "Figure. 1. Total health expenditure (millions dollars) of B.C. and Alberta (1975 to 2019)"
      ) +
      scale_x_continuous(
        breaks = seq(1975, 2020, by = 5),
        labels = function(x) as.character(x)
      ) +
      scale_y_continuous(
        limits = c(0, 40000),
        breaks = seq(0, 40000, by = 10000),
        labels = function(x) format(x, scientific = FALSE)
      ) +
      scale_color_manual(
        values = c("#4682B4", "#DC143C"),
        labels = c("B.C.", "Alta."),
        name = "Province"
      ) +
      theme(legend.position = "right", plot.title = element_text(face = "bold")) +
      guides(color = guide_legend(override.aes = list(size = 3)))
  })
  
  
  output$Plot2 <- renderPlot({
    var <- input$state1
    if (var == "Alberta") {
      y1 = 'Alb_prvt' 
      y2 = 'Alb_public'
      title = 'Total health Expenditure Private VS Public for Alberta'
      colr = c("red","black")
    } else {
      y1 = 'BC_prvt'
      y2 = 'BC_public'
      title = 'Total health Expenditure Private VS Public for BC'
      colr = c("red","green")
    }
    
    mydata2 <- mydata2 %>%
      select(Year, y1, y2) %>%
      pivot_longer(-Year, names_to = "Category", values_to = "the_values")
    
    ggplot(mydata2, aes(x = Year, y = the_values, fill = Category)) +
      geom_col(position = "dodge", width = 0.5) +
      labs(
        x = "Year 1975-2019",
        y = "Total Health Expenditures(million dollars)",
        title = title,
        fill = "Category"
      ) +
      scale_x_continuous(
        breaks = seq(1975, 2020, by = 5),
        limits = c(1975, 2020)
      ) +
      scale_y_continuous(limits = c(0, 28000)) +
      scale_fill_manual(values = colr)+
      theme_bw()
  })
  
  
  output$Plot3 <- renderPlot({
    var <- input$state2
    
    if (var == "Alberta") {
      color = "red"
        x_main = 'Alb_public'
        y_main = 'Alb_prvt'
        x_lab = 'Total Public Expenditure(million dollars) for Alberta'
        y_lab = 'Total Private Expenditure(million dollars) for Alberta'
        title = 'Figure 3. Annual total canadian health expenditure Public vs Private for Alberta'
    } else {
      color = "green"
        x_main = 'BC_public'
        y_main = 'BC_prvt'
        x_lab = 'Total Public Expenditure(million dollars) for BC'
        y_lab = 'Total Private Expenditure(million dollars) for BC'
        title = 'Figure 3. Annual total canadian health expenditure Public vs Private for BC'
    }
    
    ggplot(mydata3, aes_string(x = x_main, y = y_main)) +
      geom_point() +
      geom_smooth(method = "lm", se = FALSE, color = color) +
      labs(x = x_lab , y = y_lab, title = title) +
      theme_bw()
  })
  
  # Generate density plot based on selected variable
  output$Plot4 <- renderPlot({
    selected_variable <- input$variable
    
    if (selected_variable == "Alta.") {
      color <- "#DC143C"
        x_label <- "Municipal Government Health Expenditure of Alta."
    } else {
      color <- "#4682B4"
        x_label <- "Municipal Government Health Expenditure of B.C."
    }
    
    ggplot(mydata4, aes_string(x = selected_variable)) +
      geom_density(fill = color, alpha = 0.5,outline.type="full") +
      labs(x = x_label , y = "Density") +
      ggtitle("Figure.4. Distribution of Municipal Government health expenditure by province/territory (1975-2019)") +
      theme_minimal()+
      theme(plot.title = element_text(face = "bold"))
  })
  
  output$Plot5 <- renderPlot({
    start_year <- input$year1[1]
    end_year <- input$year1[2]
    data <- subset(mydata5, Year >= start_year & Year <= end_year)
    
    data$Federal_Direct <- data$FedDirHealth_Alta + data$FedDirHealth_BC
    data$Municipal_Government <- data$MunipGovt_Alta + data$MunipGovt_BC
    data$Private_Sector <- data$PrivExp_Alta + data$PrivExp_BC
    data$Public_Sector <- data$PubExp_Alta + data$PubExp_BC
    data$Provincial_Government <- data$ProvGov_Alta + data$ProvGov_BC
    data$Social_Security_Funds <- data$SocialSec_Alta + data$SocialSec_BC
    
    sectors_cols <- c("Federal_Direct", "Municipal_Government", "Private_Sector", "Public_Sector", "Provincial_Government", "Social_Security_Funds")
    
    mydata_long <- data %>%
      pivot_longer(cols = sectors_cols, names_to = "Source", values_to = "HealthExpenditure")
    
    ggplot(mydata_long, aes(y = Source, x = HealthExpenditure, fill = Source)) + 
      geom_boxplot(width = 0.5, lwd = 1) +  # Adjusted box width and line width
      stat_summary(fun = median, geom = "point", shape = 23, size = 4) + # Added median point
      scale_fill_manual(values = c("red", "gold", "lightgreen", "skyblue", "orange", "pink")) +
      theme_minimal() +
      theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 12), 
            axis.text.y = element_blank(), 
            axis.title.x = element_text(size = 14), 
            axis.title.y = element_text(size = 14), 
            legend.text = element_text(size = 10), 
            legend.title = element_text(size = 12), 
            plot.title = element_text(size = 15, face = "bold", hjust = 0.5)) +
      labs(title = "Figure 5: Boxplot of total expenditure by source of finance (1975-2019) ", x = "Health Expenditure (million dollars)", y = "Source of Expenditure")
  },
  height = 600,  # Adjusted the height of the output plot
  width = 800) 
  
  
  output$Plot6 <- renderPlot({    
  start_year <- input$year2[1]
  end_year <- input$year2[2]
  data <- subset(mydata5, Year >= start_year & Year <= end_year)
    
    data$Federal_Direct <- data$FedDirHealth_Alta + data$FedDirHealth_BC
    data$Municipal_Government <- data$MunipGovt_Alta + data$MunipGovt_BC
    data$Private_Sector <- data$PrivExp_Alta + data$PrivExp_BC
    data$Public_Sector <- data$PubExp_Alta + data$PubExp_BC
    data$Provincial_Government <- data$ProvGov_Alta + data$ProvGov_BC
    data$Social_Security_Funds <- data$SocialSec_Alta + data$SocialSec_BC
    
    correlation_matrix <- cor(data[, c("Federal_Direct", "Municipal_Government", "Private_Sector", "Public_Sector", "Provincial_Government", "Social_Security_Funds")], use="complete.obs")
    correlation_df <- reshape2::melt(correlation_matrix)
    names(correlation_df) <- c("Source1", "Source2", "Correlation")
    
    correlation_df <- correlation_df[is.finite(correlation_df$Correlation), ]
    
    ggplot(correlation_df, aes(x = Source1, y = Source2, fill = Correlation)) +
      geom_tile() +
      scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0, limit = c(-1,1)) +
      theme_minimal() +
      theme(axis.text.x = element_text(angle = 90, hjust = 1),  plot.title = element_text(size = 15, face = "bold", hjust = 0.5)) +
      labs(title = "Figure 6: Correlation mosaic plot of health expenditure by use of funds (1975-2019)",
           x = "Usage 1", y = "Usage 2", fill = "Correlation")
  }, height = 600, width = 800)
  
  
  output$Plot7 <- renderPlot({
    filtered_data <- subset(mydata7, expenditure >= input$part7_expenditure_range[1] & expenditure <= input$part7_expenditure_range[2])
    pr_geographic <- mapcan(boundaries = province, type = standard)
    pr_geographic <- inner_join(pr_geographic,filtered_data, by = c("pr_english" = "province"))
    ggplot(pr_geographic, aes(x = long, y = lat, group = group, fill = expenditure)) +
      geom_polygon() +
      coord_fixed() +
      theme_mapcan() +
      scale_fill_viridis_c(name = "Average Expenditure (million dollars)") +
      ggtitle("Figure.7.West Canadian Provinces Health Expenditure") +
      theme(legend.position = "right")
  })
  
  # Render the ggplot for Part 8 with reactive inputs
  output$Plot8 <- renderPlot({
    # Select the desired year range
    start_year <- input$part8_freq_range[1]
    end_year <- input$part8_freq_range[2]
    
    # Filter the data based on the selected year range
    filtered_data <- subset(mydata8, Year >= start_year & Year <= end_year)
    
    # Calculate the sum of Alta. and B.C. within the selected year range
    total_expenditure <- sum(filtered_data$Alta.) + sum(filtered_data$B.C.)
    
    # Create a new dataframe for the pie chart
    pie_data <- data.frame(
      Category = c("Alta.", "B.C."),
      Expenditure = c(sum(filtered_data$Alta.), sum(filtered_data$B.C.))
    )
    
    # Create the pie chart
    ggplot(pie_data, aes(x = "", y = Expenditure, fill = Category)) +
      geom_col(width = 1) +
      geom_text(aes(label = paste(round(Expenditure / total_expenditure * 100, 1), "%"), x = 1.5),
                position = position_stack(vjust = 0.5)) +
      theme_void() +
      labs(fill = "Category",
           title = paste("Percentage of Health Expenditure by Province", start_year, "-", end_year)) +
      coord_polar("y")
  })
  
}


################################################################################
# PART [5] : RUNNING
# Run the application
shinyApp(ui = ui, server = server)

